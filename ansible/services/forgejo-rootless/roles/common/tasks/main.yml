---
# Forgejo Rootless Main Entry Point
# This file determines which tasks to include based on operation mode

- name: Set default operation mode if not defined
  ansible.builtin.set_fact:
    operation_mode: "{{ operation_mode | default('deploy') }}"

- name: Include deploy tasks (default)
  ansible.builtin.include_tasks: deploy.yml
  when: operation_mode == 'deploy'

- name: Include backup tasks
  ansible.builtin.include_tasks: backup.yml
  when: operation_mode == 'backup' 

- name: Include restore tasks
  ansible.builtin.include_tasks: restore.yml
  when: operation_mode == 'restore'

- name: Include upgrade tasks
  ansible.builtin.include_tasks: upgrade.yml
  when: operation_mode == 'upgrade'

- name: Include repository creation tasks
  ansible.builtin.include_tasks: create_repo.yml
  when: operation_mode == 'create_repo'