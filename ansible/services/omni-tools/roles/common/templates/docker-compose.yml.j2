# https://github.com/CorentinTh/omni-tools?tab=readme-ov-file#self-host

services:
  omni-tools:
    container_name: omni-tools
    # https://hub.docker.com/r/iib0011/omni-tools/tags
    image: "iib0011/omni-tools:0.3.0"
    restart: unless-stopped
{% if not use_traefik|default(false) %}
    ports:
      - 8080:80
{% endif %}
{% if use_traefik|default(false) %}
    networks:
      - proxy
    labels:
      - "traefik.enable=true"
      - 'traefik.docker.network=proxy'
      - 'traefik.http.services.omni-tools.loadbalancer.server.port=80'
  {% if use_traefik_router_private|default(false) and private_apex_domain|default(false) %}
      ## Private
      - "traefik.http.routers.omni-tools-local.rule=Host(`{{ service_name|default('omni-tools') }}.{{ private_apex_domain }}`)"
      - "traefik.http.routers.omni-tools-local.entrypoints=websecure"
      - "traefik.http.routers.omni-tools-local.tls.certresolver=stepca"
      - "traefik.http.routers.omni-tools-local.middlewares=oauth2-admin@file"
  {% endif %}
  {% if use_traefik_router_public|default(false) and public_apex_domain|default(false) %}
      ## Public
      - "traefik.http.routers.omni-tools.rule=Host(`{{ service_name|default('omni-tools') }}.{{ public_apex_domain }}`)"
      - "traefik.http.routers.omni-tools.entrypoints=websecure"
      - "traefik.http.routers.omni-tools.tls.certresolver=cloudflare"
      - "traefik.http.routers.omni-tools.middlewares=oauth2-admin@file"
  {% endif %}

networks:
  proxy:
    external: true
{% endif %}
