name: Renovate
on:
  # Schedule Renovate to run on a regular basis
  schedule:
    - cron: "0 * * * *"  # Run every hour
  # Allow manual trigger
  workflow_dispatch:
  # Also run on changes to configuration files
  push:
    branches:
      - main

jobs:
  renovate:
    name: Renovate
    runs-on: ubuntu-latest
    # Use container-based execution like the official Gitea repo
    # https://github.com/renovatebot/renovate/pkgs/container/renovate
    container: ghcr.io/renovatebot/renovate:39.233.5
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        
      - name: Run Renovate
        run: renovate
        env:
          LOG_LEVEL: "debug"
          RENOVATE_CONFIG_FILE: "${{ github.workspace }}/config.js"
          RENOVATE_CONFIG_MIGRATION: "true"
          # Required credentials
          # Forgejo Personal Access Token for Forgejo API access
          RENOVATE_TOKEN: ${{ secrets.RENOVATE_TOKEN }}
          # GitHub.com token for fetching changelogs and bypassing API rate limits
          RENOVATE_GITHUB_COM_TOKEN: ${{ secrets.RENOVATE_GITHUB_COM_TOKEN || '' }}
          # Optional Docker Hub credentials
          HUB_DOCKER_COM_USER: ${{ secrets.HUB_DOCKER_COM_USER || '' }}
          HUB_DOCKER_COM_TOKEN: ${{ secrets.HUB_DOCKER_COM_TOKEN || '' }}