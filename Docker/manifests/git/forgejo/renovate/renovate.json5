{
  // JSON Schema for Renovate
  $schema: "https://docs.renovatebot.com/renovate-schema.json",
  // Use local renovate-config as a base
  // Format: local>account/repo
  // https://docs.renovatebot.com/config-presets/#self-hosted-git
  extends: [
    "local>renovate_account/renovate-config"
  ],
  // Only enable specific managers
  enabledManagers: [
    "github-actions",
    "dockerfile",
    "docker-compose",
    "custom.regex",
  ],
  // Custom manager for Ansible Jinja2 templates with Docker images
  customManagers: [
    {
      description: "Detects and updates Docker images in Ansible Jinja2 templates",
      customType: "regex", // explicitly set for clarity vs. jsonata
      datasourceTemplate: "docker",
      fileMatch: [
        // Standard Docker Compose patterns with Jinja2 extension
        // https://docs.renovatebot.com/modules/manager/docker-compose/#default-config
        "(^|/)(?:docker-)?compose[^/]*\\.ya?ml\\.j2$",
      ],
      matchStrings: [
        // https://github.com/renovatebot/renovate/issues/10993#issuecomment-2367518146
        "image:\\s*\"?(?<depName>[^\\s:@\"]+)(?::(?<currentValue>[-a-zA-Z0-9.]+))?(?:@(?<currentDigest>sha256:[a-zA-Z0-9]+))?\"?",
      ],
      autoReplaceStringTemplate: "image: \"{{{depName}}}:{{{newValue}}}@{{{newDigest}}}\"",
    }
  ],
  // Package-specific rules
  packageRules: [
    // https://gitlab.com/renovate-bot/renovate-runner/-/blob/main/.gitlab/renovate.json?ref_type=heads   
    {
      "description": "Trigger breaking release for major updates",
      "matchPackageNames": [
        "renovate/renovate",
        "ghcr.io/renovatebot/renovate"
      ],
      "matchUpdateTypes": ["major"],
      "commitMessagePrefix": "feat(deps)!:",
      "automergeType": "pr"
    },
    {
      "description": "Trigger feature release for minor updates",
      "matchPackageNames": [
        "renovate/renovate",
        "ghcr.io/renovatebot/renovate"
      ],
      "matchUpdateTypes": ["minor"],
      "semanticCommitType": "feat",
      "automergeType": "pr",
      "automerge": true,
      "minimumReleaseAge": null,
      "ignoreTests": true
    },
    {
      "description": "Trigger fix release for patch updates",
      "matchPackageNames": [
        "renovate/renovate",
        "ghcr.io/renovatebot/renovate"
      ],
      "matchUpdateTypes": ["patch", "digest"],
      "semanticCommitType": "fix",
      "automergeType": "pr",
      "automerge": true,
      "minimumReleaseAge": null,
      "ignoreTests": true
    },
    // Docker image rules
    {
      description: "Pin exact versions for database images",
      matchDatasources: [
        "docker"
      ],
      matchPackageNames: [
        "postgres"
      ],
      pinDigests: true,
    },
    {
      description: "Group Docker base image updates",
      matchDatasources: [
        "docker"
      ],
      matchPackageNames: [
        "node",
        "nginx",
        "alpine"
      ],
      groupName: "Docker base images",
      groupSlug: "docker-base",
    },
    // Use regex to only match stable semver tags like X.Y.Z where X is 1-3 digits.
    // This avoids prefixed tags (vX.Y.Z) and date-based tags like YYYYMMDD.M.P (e.g., 20220225.0.205544).
    {
      matchDatasources: ["docker"],
      matchPackageNames: ["kopia/kopia"],
      versioning: "regex:^(?<major>\\d{1,3})\\.(?<minor>\\d+)\\.(?<patch>\\d+)$",
    },
  ],
}